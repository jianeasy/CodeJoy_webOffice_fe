!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).WebOfficeSDK={})}(this,function(e){"use strict";var t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function n(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})}function r(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}var i=function(){function e(){}return e.add=function(t){e.HANDLE_LIST.push(t),window.addEventListener("message",t,!1)},e.remove=function(t){var n=e.HANDLE_LIST.indexOf(t);n>=0&&e.HANDLE_LIST.splice(n,1),window.removeEventListener("message",t,!1)},e.empty=function(){for(;e.HANDLE_LIST.length;)window.removeEventListener("message",e.HANDLE_LIST.shift(),!1)},e.parse=function(e){try{return"object"==typeof e?e:e?JSON.parse(e):e}catch(t){return console.log("Message.parse Error:",t),e}},e.HANDLE_LIST=[],e}();function o(e){if(!e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function a(e){return"[object Function]"==={}.toString.call(e)}var c,s,u,l,f,d={origin:""};function p(e,t){d[e]=t}function v(e){return d[e]}function h(e){return!!function(e,t){return e!==t&&(e.replace(/www\./i,"").toLowerCase()!==t.replace(/www\./i,"").toLowerCase()||(e.match("www.")?void 0:(p("origin",t),!1)))}(v("origin"),e.origin)}function b(e,t,n){void 0===n&&(n=!1);var r=null,i=function(n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=t.clientHeight,o=t.clientWidth;e.style.cssText+="height: "+(r||i)+"px; width: "+(n||o)+"px"};return n&&(i=function(e,t){void 0===t&&(t=1e3);var n=null;return function(){n&&clearTimeout(n),n=setTimeout(function(){return e()},t)}}(i,200)),window.ResizeObserver?(r=new ResizeObserver(function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(r.contentRect){var o=r.contentRect,a=o.width,c=o.height;i.call(void 0,a,c)}}})).observe(t):window.addEventListener("resize",function(){return i()}),function(){null==r||r.disconnect(),window.removeEventListener("resize",function(){return i()})}}!function(e){e.Spreadsheet="s",e.Writer="w",e.Presentation="p",e.Pdf="f",e.Outline="o",e.Dbt="d"}(c||(c={})),function(e){e.unknown="unknown",e.spreadsheet="s",e.writer="w",e.presentation="p",e.pdf="f"}(s||(s={})),function(e){e.wps="w",e.et="s",e.presentation="p",e.pdf="f"}(u||(u={})),function(e){e.nomal="nomal",e.simple="simple"}(l||(l={})),function(e){e[e.requestFullscreen=1]="requestFullscreen",e[e.exitFullscreen=0]="exitFullscreen"}(f||(f={}));var m,w,g=(m=0,function(){return m+=1}),y=function(e,t,n,r){void 0===n&&(n=!0),void 0===r&&(r={});var i="string"==typeof t?document.querySelector(t):t;if(!w){(w=document.createElement("iframe")).classList.add("web-office-iframe");var o={id:"office-iframe",src:e,scrolling:"no",frameborder:"0",allowfullscreen:"allowfullscreen",webkitallowfullscreen:"true",mozallowfullscreen:"true",allow:"clipboard-read; clipboard-write"};if(r&&Object.keys(r).length&&r.allow){var a=r.allow instanceof Array?r.allow:r.allow.split(";");a.unshift("clipboard-write"),a.unshift("clipboard-read"),r.allow=a.join(";"),Object.assign(o,r)}for(var c in i?o.style="width: "+i.clientWidth+"px; height: "+i.clientHeight+"px;":((i=document.createElement("div")).classList.add("web-office-default-container"),function(e){var t=document.createElement("style");document.head.appendChild(t);var n=t.sheet;n.insertRule(e,n.cssRules.length)}(".web-office-default-container {position: absolute; padding: 0;  margin: 0; width: 100%; height: 100%; left: 0; top: 0;}"),document.body.appendChild(i),o.style="position: fixed; top: 0; right: 0; bottom: 0; left: 0; width: 100%; height: 100%;"),o)w.setAttribute(c,o[c]);var s=document.createElement("style");s.textContent="\n      .web-office-iframe {\n        display: block;\n      }\n    ",document.head.appendChild(s);var u=n?b(w,i):Function.prototype;i.appendChild(w),w.destroy=function(){w.parentNode.removeChild(w),w=null,u()}}return w},k=function(e){y().contentWindow&&y().contentWindow.postMessage(JSON.stringify(e),v("origin"))};function O(e,t,n){return new Promise(function(r){var o=g(),a=function(e){if(!h(e)){var t=i.parse(e.data);t.eventName===n&&t.msgId===o&&(r(t.data),i.remove(a))}};i.add(a),k({data:e,msgId:o,eventName:t})})}var j=function(e){return O(e,"wps.jssdk.api","wps.api.reply")},I=function(e){return O(e,"api.basic","api.basic.reply")},E={idMap:{}};function S(e){return n(this,void 0,void 0,function(){var t,n,o,a,c,s,u,l,f,d;return r(this,function(r){switch(r.label){case 0:return h(e)?[2]:(t=i.parse(e.data),n=t.eventName,o=t.callbackId,a=t.data,o&&(c=E.idMap[o])?(s=c.split(":"),u=s[0],l=s[1],"api.callback"===n&&E[u]&&E[u][l]?[4,(d=E[u][l]).callback.apply(d,a.args)]:[3,2]):[3,2]);case 1:f=r.sent(),k({result:f,callbackId:o,eventName:"api.callback.reply"}),r.label=2;case 2:return[2]}})})}var T=function(e){return n(void 0,void 0,void 0,function(){function t(){return Object.keys(E.idMap).find(function(e){return E.idMap[e]===o+":"+n})}var n,o,a,c,s,u,l,f,d;return r(this,function(r){switch(r.label){case 0:return n=e.prop,o=e.parentObjId,[4,x([a=e.value])];case 1:return c=r.sent(),s=c[0],u=c[1],e.value=s[0],l=Object.keys(u)[0],f=E[o],null===a&&f&&f[n]&&((d=t())&&delete E.idMap[d],delete f[n],Object.keys(f).length||delete E[o],Object.keys(E.idMap).length||i.remove(S)),l&&(Object.keys(E.idMap).length||i.add(S),E[o]||(E[o]={}),E[o][n]={callbackId:l,callback:u[l]},(d=t())&&delete E.idMap[d],E.idMap[l]=o+":"+n),[2]}})})},_=function(e,o,a,c){return n(void 0,void 0,void 0,function(){var s,u,l,f,d,p,v,b;return r(this,function(m){switch(m.label){case 0:return s=g(),f=new Promise(function(e,t){u=e,l=t}),d={},o.args?[4,x(o.args)]:[3,2];case 1:p=m.sent(),v=p[0],b=p[1],o.args=v,d=b,m.label=2;case 2:return"api.setter"!==e?[3,4]:[4,T(o)];case 3:m.sent(),m.label=4;case 4:return function(e){var n=e[0],r=e[1];"function"==typeof(n=t({},n)).data&&(n.data=n.data());r(),k(n)}([{eventName:e,data:o,msgId:s},function(){var t=this,o=function(f){return n(t,void 0,void 0,function(){var t,n,p;return r(this,function(r){switch(r.label){case 0:return h(f)?[2]:"api.callback"===(t=i.parse(f.data)).eventName&&t.callbackId&&d[t.callbackId]?[4,d[t.callbackId].apply(d,t.data.args)]:[3,2];case 1:n=r.sent(),k({result:n,eventName:"api.callback.reply",callbackId:t.callbackId}),r.label=2;case 2:return t.eventName===e+".reply"&&t.msgId===s&&(t.error?((p=new Error("")).stack=t.error+"\n"+a,c&&c(),l(p)):u(t.result),i.remove(o)),[2]}})})};return i.add(o),f}]),[2,f]}})})};function x(e){return n(this,void 0,void 0,function(){var t,n,i,a,c,s,u,l,f,d,p;return r(this,function(r){switch(r.label){case 0:t={},n=[],i=e.slice(0),r.label=1;case 1:return i.length?(a=void 0,[4,i.shift()]):[3,13];case 2:return(c=r.sent())&&c.done?[4,c.done()]:[3,4];case 3:r.sent(),r.label=4;case 4:if(!o(a))return[3,11];for(u in a={},s=[],c)s.push(u);l=0,r.label=5;case 5:return l<s.length?(f=s[l],d=c[f],/^[A-Z]/.test(f)?d&&d.done?[4,d.done()]:[3,7]:[3,8]):[3,10];case 6:r.sent(),r.label=7;case 7:d&&d.objId?d={objId:d.objId}:"function"==typeof d&&(p=g(),t[p]=d,d={callbackId:p}),r.label=8;case 8:a[f]=d,r.label=9;case 9:return l++,[3,5];case 10:return[3,12];case 11:c&&c.objId?a={objId:c.objId}:"function"==typeof c&&void 0===c.objId?(p=g(),t[p]=c,a={callbackId:p}):a=c,r.label=12;case 12:return n.push(a),[3,1];case 13:return[2,[n,t]]}})})}var C=function(e,n){void 0===n&&(n=!0);var r=t({},e),i=r.headers,o=void 0===i?{}:i,a=r.subscriptions,c=void 0===a?{}:a,s=r.mode,u=void 0===s?l.nomal:s,f=r.commonOptions,d=o.backBtn,p=void 0===d?{}:d,v=o.shareBtn,h=void 0===v?{}:v,b=o.otherMenuBtn,m=void 0===b?{}:b,w=function(e,t){e.subscribe&&"function"==typeof e.subscribe&&(e.callback=t,c[t]=e.subscribe,n&&delete e.subscribe)};if(w(p,"wpsconfig_back_btn"),w(h,"wpsconfig_share_btn"),w(m,"wpsconfig_other_menu_btn"),m.items&&Array.isArray(m.items)){var g=[];m.items.forEach(function(e,t){switch(void 0===e&&(e={}),e.type){case"export_img":e.type=1,e.callback="export_img";break;case"export_pdf":e.type=1,e.callback="export_pdf";break;case"save_version":e.type=1,e.callback="save_version";break;case"about_wps":e.type=1,e.callback="about_wps";break;case"split_line":e.type=2;break;case"custom":e.type=3,w(e,"wpsconfig_other_menu_btn_"+t),g.push(e)}}),g.length&&(P||F)&&(m.items=g)}r.url=r.url||r.wpsUrl;var y=[];if((u===l.simple||f&&!1===f.isShowTopArea)&&y.push("simple","hidecmb"),r.debug&&y.push("debugger"),r.url&&y.length&&(r.url=r.url+(r.url.indexOf("?")>=0?"&":"?")+y.join("&")),f&&(f.isParentFullscreen||f.isBrowserViewFullscreen)&&(document.addEventListener("fullscreenchange",W),document.addEventListener("webkitfullscreenchange",W),document.addEventListener("mozfullscreenchange",W)),r.wordOptions&&(r.wpsOptions=r.wordOptions),r.excelOptions&&(r.etOptions=r.excelOptions),r.pptOptions&&(r.wppOptions=r.pptOptions),"object"==typeof c.print){var k="wpsconfig_print";"function"==typeof c.print.subscribe&&(c[k]=c.print.subscribe,r.print={callback:k},void 0!==c.print.custom&&(r.print.custom=c.print.custom)),delete c.print}"function"==typeof c.exportPdf&&(c[k="wpsconfig_export_pdf"]=c.exportPdf,r.exportPdf={callback:k},delete c.exportPdf);return r.commandBars&&L(r.commandBars,!1),t(t({},r),{subscriptions:c})},A=function(e){var n=t({},e);n.fileToken=n.token||n.fileToken;var r=n.appId,i=n.fileId,a=n.officeType,s=n.fileToken,u=n.endpoint,l=n.customArgs,f=void 0===l?"":l;if(!Object.values(c).includes(a))throw Error("[WebOfficeSDK.init] officeType属性值错误，可选值参考WebOfficeSDK.OfficeType: "+JSON.stringify(c));var d=s?1:0,p={token:""};if("string"==typeof s?p.token=s:o(s)&&(p=t({tokenData:p},s)),d&&!p.token)return console.error("[WebOfficeSDK.init] token设置无效"),n;if("string"!=typeof u)throw Error("[WebOfficeSDK.init] endpoint期望为字符串");if(u&&!u.startsWith("http"))return console.error("[WebOfficeSDK.init] endpoint仅支持http、https的地址"),n;if(n.url=u+"/office/"+a+"/"+i+"?_w_appid="+r+"&_w_tokentype="+d,o(f)){var v=Object.entries(f).map(function(e){var t=e[0],n=e[1];return t+"="+encodeURIComponent(n)}).join("&");n.url=n.url+"&"+v}return t({},n)},N=function(e){void 0===e&&(e="");var t="";if(!t&&e){var n=e.toLowerCase();-1!==n.indexOf("/office/s/")&&(t=s.spreadsheet),-1!==n.indexOf("/office/w/")&&(t=s.writer),-1!==n.indexOf("/office/p/")&&(t=s.presentation),-1!==n.indexOf("/office/f/")&&(t=s.pdf)}if(!t){var r=e.match(/[\?&]type=([a-z]+)/)||[];t=u[r[1]]||""}return t};function L(e,t){void 0===t&&(t=!0);var n=e.map(function(e){var t=e.attributes;if(!Array.isArray(t)){var n=[];for(var r in t)if(t.hasOwnProperty(r)){var i={name:r,value:t[r]};n.push(i)}e.attributes=n}return e});return t&&k({data:n,eventName:"setCommandBars"}),n}var D=window.navigator.userAgent.toLowerCase(),P=/Android|webOS|iPhone|iPod|BlackBerry|iPad/i.test(D),F=function(){try{return-1!==window._parent.location.search.indexOf("from=wxminiprogram")}catch(e){return!1}}();function W(){var e={status:f.requestFullscreen},t=document,n=t.fullscreenElement||t.webkitFullscreenElement||t.mozFullScreenElement;e.status=n?f.requestFullscreen:f.exitFullscreen,k({data:e,eventName:"fullscreenchange"})}var R=function(){E.idMap={}};function B(){console.group("JSSDK 事件机制调整说明"),console.warn("jssdk.on、jssdk.off 和 jssdk.Application.Sub 将在后续版本中被弃用，建议使用改进后的 ApiEvent"),console.warn("具体请参考：https://wwo.wps.cn/docs/front-end/basic-usage/events/intro/"),console.groupEnd()}var V=0,z=!0,H=new Set;function K(e){return V+=1,!e&&function(e){H.forEach(function(t){return t(e)})}(V),V}function M(){var e=new Error("");return(e.stack||e.message||"").split("\n").slice(2).join("\n")}function q(e,o){var a=this;z=!1;var c,u=o.Events,l=o.Enum,f=o.Props,d=f[0],p=f[1],v={objId:V};switch(function e(n,r,i){var o=r.slice(0);var a=function(){var r=o.shift();!r.alias&&~J.indexOf(r.prop)&&o.push(t(t({},r),{alias:r.prop+"Async"})),Object.defineProperty(n,r.alias||r.prop,{get:function(){var o=this;if(!z){var a=1===r.cache,c=a&&this["__"+r.prop+"CacheValue"];if(!c){var s=M(),u=K(a),l=function(){for(var e,o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];void 0!==r.caller?function e(n,r,i){var o=r.slice(0);var a=function(){var r=o.shift();!r.alias&&~J.indexOf(r.prop)&&o.push(t(t({},r),{alias:r.prop+"Async"})),Object.defineProperty(n,r.alias||r.prop,{get:function(){var t=this;if(!z){var o=1===r.cache,a=o&&this["__"+r.prop+"CacheValue"];if(!a){var c=M(),s=K(o),u=function(){for(var t,o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];void 0!==r.caller?e(t={objId:K()},i[r.caller],i):t={};return U(u,t,"api.caller",{obj:u,args:o,parentObjId:n.objId,objId:t.objId,prop:r.prop},c),t};return u.objId=-1,void 0!==r.getter&&(u.objId=s,e(u,i[r.getter],i)),U(n,u,"api.getter",{parentObjId:n.objId,objId:u.objId,prop:r.prop},c,function(){delete t["__"+r.prop+"CacheValue"]}),o&&(this["__"+r.prop+"CacheValue"]=u),u}return a}},set:function(e){if(!z){var t=M();return U(n,{},"api.setter",{value:e,parentObjId:n.objId,objId:-1,prop:r.prop},t)}}})};for(;o.length;)a()}(e={objId:K()},i[r.caller],i):e={};return U(l,e,"api.caller",{obj:l,args:o,parentObjId:n.objId,objId:e.objId,prop:r.prop},s),e};return l.objId=-1,void 0!==r.getter&&(l.objId=u,e(l,i[r.getter],i)),U(n,l,"api.getter",{parentObjId:n.objId,objId:l.objId,prop:r.prop},s,function(){delete o["__"+r.prop+"CacheValue"]}),a&&(this["__"+r.prop+"CacheValue"]=l),l}return c}},set:function(e){if(!z){var t=M();return U(n,{},"api.setter",{value:e,parentObjId:n.objId,objId:-1,prop:r.prop},t)}}})};for(;o.length;)a()}(v,d,p),v.Events=u,v.Enum=l,e.Enum=v.Enum,e.Events=v.Events,e.Props=f,N(e.url)){case s.writer:e.WordApplication=e.WpsApplication=function(){return v};break;case s.spreadsheet:e.ExcelApplication=e.EtApplication=function(){return v};break;case s.presentation:e.PPTApplication=e.WppApplication=function(){return v};break;case s.pdf:e.PDFApplication=function(){return v}}e.Application=v,e.Free=function(e){return _("api.free",{objId:e},"")},e.Stack=v.Stack=(c=function(t){e&&e.Free(t)},function(){var e=[],t=function(t){e.push(t)};return H.add(t),{End:function(){c(e),H.delete(t)}}});var b={};i.add(function(e){return n(a,void 0,void 0,function(){var t,n,o,a,c;return r(this,function(r){switch(r.label){case 0:return h(e)?[2]:"api.event"===(t=i.parse(e.data)).eventName&&t.data?(n=t.data,o=n.eventName,a=n.data,(c=b[o])?[4,c(a)]:[3,2]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})}),v.Sub={};var m=function(e){var t=u[e];Object.defineProperty(v.Sub,t,{set:function(e){B(),b[t]=e,k({eventName:"api.event.register",data:{eventName:t,register:!!e,objId:V+=1}})}})};for(var w in u)m(w)}var J=["ExportAsFixedFormat","GetOperatorsInfo","ImportDataIntoFields","ReplaceText","ReplaceBookmark","GetBookmarkText","GetComments"];function G(e,n,r){var i=n.slice(0);var o=function(){var n=i.shift();if(!n.alias&&~J.indexOf(n.prop)){i.push(t(t({},n),{alias:n.prop+"Async"}))}Object.defineProperty(e,n.alias||n.prop,{get:function(){var t=this;if(z){return}var i=n.cache===1;var o=i&&this["__"+n.prop+"CacheValue"];if(!o){var a=M();var c=K(i);var s=function(){for(var t=[],i=0,o;i<arguments.length;i++){t[i]=arguments[i]}if(n.caller!==undefined){o={objId:K()};G(o,r[n.caller],r)}else{o={}}return U(u,o,"api.caller",{obj:u,args:t,parentObjId:e.objId,objId:o.objId,prop:n.prop},a),o};var u=s;u.objId=-1;if(n.getter!==undefined){u.objId=c;G(u,r[n.getter],r)}U(e,u,"api.getter",{parentObjId:e.objId,objId:u.objId,prop:n.prop},a,function(){delete t["__"+n.prop+"CacheValue"]});if(i){this["__"+n.prop+"CacheValue"]=u}return u}return o},set:function(t){if(z){return}var r=M();return U(e,{},"api.setter",{value:t,parentObjId:e.objId,objId:-1,prop:n.prop},r)}})};while(i.length){o()}}function U(e,t,n,r,i,o){var a,c=(e.done?e.done():Promise.resolve()).then(function(){return a||(a=_(n,r,i,o)),a});t.done=function(){return c},t.then=function(e,n){return r.objId>=0?(t.then=null,t.catch=null,c.then(function(){e(t)}).catch(function(e){return n(e)})):c.then(e,n)},t.catch=function(e){return c.catch(e)},t.Destroy=function(){return _("api.free",{objId:t.objId},"")}}var Z={};var Q=null,X={fileOpen:"fileOpen",tabSwitch:"tabSwitch",fileSaved:"fileSaved",fileStatus:"fileStatus",fullscreenChange:"fullscreenChange",error:"error",stage:"stage"},Y={getToken:"api.getToken",onToast:"event.toast",onHyperLinkOpen:"event.hyperLinkOpen",getClipboardData:"api.getClipboardData"};function $(e,o,a,c,s,u,l){var f=this;void 0===a&&(a={});i.add(function(l){return n(f,void 0,void 0,function(){var n,f,d,p,v,b,m,w,g,y,O,j,I,E,S,T,_,x,C;return r(this,function(r){switch(r.label){case 0:return h(l)?[2]:(n=i.parse(l.data),f=n.eventName,d=void 0===f?"":f,p=n.data,v=void 0===p?null:p,b=n.url,m=void 0===b?null:b,-1!==["wps.jssdk.api"].indexOf(d)?[2]:"ready"!==d?[3,1]:(s.apiReadySended&&function(e){var t=[];Object.keys(Z).forEach(function(n){Z[n].forEach(function(r){var i=n;e.off(i,r),t.push({handle:r,eventName:i})}),delete Z[n]}),t.forEach(function(e){var t=e.eventName,n=e.handle;null==Q||Q.ApiEvent.AddApiEventListener(t,n)})}(o),k({eventName:"setConfig",data:t(t({},a),{version:e.version})}),e.tokenData&&e.setToken(t(t({},e.tokenData),{hasRefreshTokenConfig:!!a.refreshToken})),e.iframeReady=!0,[3,15]));case 1:return"error"!==d?[3,2]:(o.emit(X.error,v),[3,15]);case 2:return"open.result"!==d?[3,3]:(void 0!==(null===(_=null==v?void 0:v.fileInfo)||void 0===_?void 0:_.officeVersion)&&(e.mainVersion=v.fileInfo.officeVersion,console.log("WebOfficeSDK Main Version: V"+e.mainVersion)),o.emit(X.fileOpen,v),[3,15]);case 3:return"api.scroll"!==d?[3,4]:(window.scrollTo(v.x,v.y),[3,15]);case 4:if(d!==Y.getToken)return[3,9];w={token:!1},r.label=5;case 5:return r.trys.push([5,7,,8]),[4,s.refreshToken()];case 6:return w=r.sent(),[3,8];case 7:return g=r.sent(),console.error("refreshToken: "+(g||"fail to get")),[3,8];case 8:return k({eventName:Y.getToken+".reply",data:w}),[3,15];case 9:if(d!==Y.getClipboardData)return[3,14];y={text:"",html:""},r.label=10;case 10:return r.trys.push([10,12,,13]),[4,s.getClipboardData()];case 11:return y=r.sent(),[3,13];case 12:return O=r.sent(),console.error("getClipboardData: "+(O||"fail to get")),[3,13];case 13:return k({eventName:Y.getClipboardData+".reply",data:y}),[3,15];case 14:d===Y.onToast?s.onToast(v):d===Y.onHyperLinkOpen?s.onHyperLinkOpen(v):"stage"===d?o.emit(X.stage,v):"event.callback"===d?(j=v.eventName,I=v.data,E=j,"fullScreenChange"===j&&(E=X.fullscreenChange),"file.saved"===j&&(E=X.fileStatus),((null===(x=a.commonOptions)||void 0===x?void 0:x.isBrowserViewFullscreen)||(null===(C=a.commonOptions)||void 0===C?void 0:C.isParentFullscreen))&&"fullscreenchange"===E&&(S=I.status,T=I.isDispatchEvent,a.commonOptions.isBrowserViewFullscreen?function(e,t,n,r){if(0===e){if(t.dataset.pastSize){var i=JSON.parse(t.dataset.pastSize),o=i.width,a=i.height;delete t.dataset.pastSize,t.style="position: static; width: "+o+"; height: "+a}}else 1===e&&(t.dataset.pastSize=JSON.stringify({width:t.clientWidth+"px",height:t.clientHeight+"px"}),t.style="position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index:999;");r&&function(e){["fullscreen","fullscreenElement"].forEach(function(t){Object.defineProperty(document,t,{get:function(){return!!e.status},configurable:!0})});var t=new CustomEvent("fullscreenchange");document.dispatchEvent(t)}({status:e})}(S,u,0,T):a.commonOptions.isParentFullscreen&&function(e,t,n){var r=document.querySelector(n),i=r&&1===r.nodeType?r:t;if(0===e){var o=document,a=o.exitFullscreen||o.mozCancelFullScreen||o.msExitFullscreen||o.webkitCancelFullScreen||o.webkitExitFullscreen;a.call(document)}else if(1===e){var c=i.requestFullscreen||i.mozRequestFullScreen||i.msRequestFullscreen||i.webkitRequestFullscreen;c.call(i)}}(S,u,a.commonOptions.isParentFullscreen)),o.emit(E,I)):"api.ready"===d&&q(e,v),r.label=15;case 15:return"function"==typeof c[d]&&c[d](e,m||v),[2]}})})})}function ee(e){return new Promise(function(t){var n=function(r){h(r)||i.parse(r.data).eventName===e&&(t(),i.remove(n))};i.add(n)})}function te(e){var c,s=this;void 0===e&&(e={}),Q&&Q.destroy();try{var u=C(e),l=u.subscriptions,f=void 0===l?{}:l,d=u.mount,v=void 0===d?null:d,h=u.url,b=u.refreshToken,m=u.onToast,w=u.onHyperLinkOpen,g=u.getClipboardData,O=u.attrAllow,E=u.isListenResize;p("origin",(h.match(/https*:\/\/[^\/]+/g)||[])[0]);var S=y(h,v,null==E||E,{allow:O}),T=ee("ready"),_=ee("open.result"),x=ee("api.ready");v&&(v.clientWidth,v.clientHeight);delete u.mount,h&&delete u.url,delete u.subscriptions;var A=(c=c||Object.create(null),{on:function(e,t){(c[e]||(c[e]=[])).push(t)},off:function(e,t){c[e]&&c[e].splice(c[e].indexOf(t)>>>0,1)},emit:function(e,t){(c[e]||[]).slice().map(function(e){e(t)}),(c["*"]||[]).slice().map(function(n){n(e,t)})}}),N={apiReadySended:!1},D=function(e,t,i){return n(s,void 0,void 0,function(){return r(this,function(n){switch(n.label){case 0:return function(e,t,n){if(Z[e]){var r=!!Z[e].find(function(e){return e===t});return r&&"off"===n?(A.off(e,t),Z[e]=Z[e].filter(function(e){return e!==t}),!!Z[e].length||(Z[e]=void 0,!1)):(r||"on"!==n||(Z[e].push(t),A.on(e,t)),!0)}return"on"===n?(Z[e]=[],Z[e].push(t),!1):"off"===n||void 0}(e,t,i)?[3,2]:[4,T];case 1:n.sent(),function(e,t){var n=e.eventName,r=e.type,i=e.handle;"on"===t?A.on(n,i):A.off(n,i),"base.event"===r&&k({eventName:"basic.event",data:{eventName:n,action:t}}),B()}(function(e,t){var n=e,r="base.event";switch(n){case X.fileSaved:console.warn("fileSaved事件监听即将弃用， 推荐使用fileStatus进行文件状态的监听"),n="fileStatus";break;case X.fullscreenChange:n="fullscreenchange";break;case"error":case"fileOpen":r="callback.event"}return{eventName:n,type:r,handle:t}}(e,t),i),n.label=2;case 2:return[2]}})})};return Q={url:h,iframe:S,version:"1.1.27",iframeReady:!1,tokenData:null,commandBars:null,tabs:{getTabs:function(){return n(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,T];case 1:return e.sent(),[2,I({api:"tab.getTabs"})]}})})},switchTab:function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,T];case 1:return t.sent(),[2,I({api:"tab.switchTab",args:{tabKey:e}})]}})})}},setCooperUserColor:function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,T];case 1:return t.sent(),[2,I({api:"setCooperUserColor",args:e})]}})})},setToken:function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,T];case 1:return t.sent(),Q.tokenData=e,k({eventName:"setToken",data:e}),[2]}})})},ready:function(){return n(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return N.apiReadySended?[3,2]:[4,_];case 1:e.sent(),N.apiReadySended=!0,k({eventName:"api.ready"}),e.label=2;case 2:return[4,x];case 3:return e.sent(),[2,new Promise(function(e){return setTimeout(function(){return e(null==Q?void 0:Q.Application)},0)})]}})})},destroy:function(){Z={},S.destroy(),i.empty(),Q=null,H=new Set,V=0,z=!0,document.removeEventListener("fullscreenchange",W),document.removeEventListener("webkitfullscreenchange",W),document.removeEventListener("mozfullscreenchange",W),R()},save:function(){return n(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,T];case 1:return e.sent(),[2,j({api:"save"})]}})})},setCommandBars:function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,T];case 1:return t.sent(),L(e),[2]}})})},updateConfig:function(e){return void 0===e&&(e={}),n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,T];case 1:return t.sent(),e.commandBars?(console.warn("Deprecated: `updateConfig()` 方法即将废弃，请使用`setCommandBars()`代替`updateConfig()`更新`commandBars`配置。"),[4,L(e.commandBars)]):[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},executeCommandBar:function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,T];case 1:return t.sent(),L([{cmbId:e,attributes:[{name:"click",value:!0}]}]),[2]}})})},on:function(e,t){return n(this,void 0,void 0,function(){return r(this,function(n){return[2,this.ApiEvent.AddApiEventListener(e,t)]})})},off:function(e,t){return n(this,void 0,void 0,function(){return r(this,function(n){return[2,this.ApiEvent.RemoveApiEventListener(e,t)]})})},ApiEvent:{AddApiEventListener:function(e,t){return n(this,void 0,void 0,function(){return r(this,function(n){switch(n.label){case 0:return[4,D(e,t,"on")];case 1:return[2,n.sent()]}})})},RemoveApiEventListener:function(e,t){return n(this,void 0,void 0,function(){return r(this,function(n){switch(n.label){case 0:return[4,D(e,t,"off")];case 1:return[2,n.sent()]}})})}}},function(e,t,n,r,i,o){t&&a(t)&&(i.refreshToken=t,e.refreshToken={eventName:Y.getToken});o&&a(o)&&(i.getClipboardData=o,e.getClipboardData={eventName:Y.getClipboardData});n&&a(n)&&(i.onToast=n,e.onToast={eventName:Y.onToast});r&&a(r)&&(i.onHyperLinkOpen=r,e.onHyperLinkOpen={eventName:Y.onHyperLinkOpen})}(u,b,m,w,N,g),$(Q,A,u,f,N,S),u.fileToken&&(o(u.fileToken)?Q.setToken(t({},u.fileToken)):Q.setToken({token:u.fileToken})),Q}catch(e){console.error(e)}}function ne(e){var n,r,i=t({},e);if(i.url)throw Error("[WebOfficeSDK.init] 不支持传递url，请使用appId、fileId、officeType、token等参数初始化！");if(!i.appId||!i.fileId||!i.officeType)throw Error("[WebOfficeSDK.init] appId、fileId、officeType为必选项！");if(void 0!==i.token&&"string"!=typeof i.token&&"string"!=typeof(null===(n=i.token)||void 0===n?void 0:n.token))throw Error("[WebOfficeSDK.init] token类型必须为字符串！");if(void 0!==i.fileToken&&"string"!=typeof i.fileToken&&"string"!=typeof(null===(r=i.fileToken)||void 0===r?void 0:r.token))throw Error("[WebOfficeSDK.init] fileToken类型必须为字符串！");return i.endpoint=i.endpoint||"https://o.wpsgo.com",te(A(i))}console.log("WebOfficeSDK JS-SDK V1.1.27");var re=Object.freeze({__proto__:null,listener:$,config:te,createApp:ne,get OfficeType(){return c}});window.WPS=re;var ie=te,oe=ne,ae=c,ce={config:ie,init:oe,OfficeType:ae};e.OfficeType=ae,e.config=ie,e.default=ce,e.init=oe,Object.defineProperty(e,"__esModule",{value:!0})});
